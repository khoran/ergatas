
<div class="container-fluid">
    <div class="row">
        <div class="col-xl-2 col-md-3 col-sm-4 d-flex flex-sm-column flex-wrap dashboard-menu"  xstyle="border-right-width: 1px; border-right-style: solid;">

            <span class="mb-4" style="padding: .375rem .75rem;" data-bind="text: $root.loggedInUser() && $root.loggedInUser().email"></span>

            <button class="btn btn-outline-dark " 
                data-bind="visible: $root.loggedInUser() && ! $root.loggedInUser().is_org_admin(), click: $root.navigateFn('profile')">
                <i class="fas fa-edit"></i> 
                <text data-bind=" text: $root.hasProfile() ? 'Edit Profile' : 'Create New Profile' "></text>
            </button>
            <button class="btn btn-outline-dark " href="#" data-bind="click: $root.navigateFn('saved-searches')"> 
                <i class="fas fa-save"></i> Saved Searches</button>
            <button class="btn btn-outline-dark " id="landing_page_button" href="#" data-bind="click: $root.navigateFn('claim-org') ">
                <i class="fas fa-building"></i> Landing Page</button>

            <div data-bind="if: $root.hasRole('organization_review')" >
                <div class="my-5" >

                    <button class="btn btn-outline-dark" 
                        data-bind="click: $root.navigateFn('organization-review')">Pending Organizations</button>
                    <button class="btn btn-outline-dark" 
                        data-bind="click: $root.navigateFn('reports')">Reports</button>
                    <button class="btn btn-outline-dark" 
                        data-bind="click: $root.navigateFn('message-moderation')">Message Moderation</button>
            
                </div>
            </div>




            <button class="btn btn-outline-dark " href="/signOut"  rel="nofollow" data-bind="click: $root.signOut">
                <i class="fas fa-sign-out-alt"></i> Sign Out</button>
            <button class="btn btn-outline-danger btn-sm mt-sm-4 " data-bind="click: $root.deleteAccount">
                <i class="fas fa-trash-alt"></i> Delete Account</button>
        </div>
        <div class="col-xl-10 col-md-9 col-sm-8">
            <div class="row my-5" data-bind="with: stats">
                <div class="col">
                    <span class="mr-4 text-nowrap"><i class="fas fa-eye"></i> Page Views: <span  data-bind="text: pageViews"></span></span>
                    <span class="mr-4 text-nowrap"><i class="fas fa-donate"></i> Donation Clicks: <span data-bind="text: donationClicks"></span></span>
                    <span class="text-nowrap"><i class="fas fa-praying-hands"></i> Prayers: <span data-bind="text: prayers"></span></span>
                </div>
            </div>

            <!-- manage-org component inserted: extracted org display + edit form -->
            <manage-org params="db: $component, appState: $root.appState"></manage-org>
            <div class="row my-5">
                <div class="col-md-9">
                    <h2 class="d-inline-block">Donations</h2>
                    <div class="float-md-right">
                        <div class="btn-group" >
                            <button class="btn" data-bind="click: () => sortField('created_on'),
                                class: sortField() === 'created_on'? 'btn-dark': 'btn-outline-dark'">Date</button>
                            <button class="btn" data-bind="click: () => sortField('amount'),
                                class: sortField() === 'amount'? 'btn-dark': 'btn-outline-dark'">Amount</button>
                        </div>

                        <div class="btn-group">
                            <button class="btn" data-bind="click: () => sortDir('asc'),
                                class: sortDir() === 'asc'? 'btn-dark':'btn-outline-dark'"><i title="ascending" class="fas fa-sort-amount-up "></i></button>
                            <button class="btn" data-bind="click: () => sortDir('desc'),
                                class: sortDir() === 'desc'? 'btn-dark':'btn-outline-dark'"><i title="descending" class="fas fa-sort-amount-down"></i></button>
                        </div>
                    </div>


                    <div data-bind="foreach: donations">
                        <hr/>
                        <div class="text-nowrap d-flex xjustify-content-around " data-bind="click: $component.donationRowClick">
                            <a href="#" class="mr-auto"><i title="Expand" class="fas fa-caret-down fa-2x align-bottom"></i></a>

                            <span data-bind="visible: ! $component.singleProfile(),text: name" class="mr-auto align-text-bottom mx-4"></span>
                            <span data-bind="class: $component.singleProfile() ? '':'d-none d-sm-inline', text: $component.formatDate(created_on)" class="mr-auto align-text-bottom mx-4"></span>
                            <span class="mr-auto align-text-bottom mx-4">
                                <span data-bind="text: $component.formatMoney(amount)"></span>
                                <i class="fas fa-sync ml-1" title="Recurring Donation" data-bind="visible: donation_type==='recurring'"></i>
                            </span>
                            <span class="mr-auto d-none d-md-inline mx-4" data-bind="with: $component.paymentStatus($data)"> <span data-bind="text: rtext, class: rclass"></span> </span>
                        </div>
                        <div class="collapse ml-5" data-bind="attr: {id: 'details_'+possible_transaction_key}">

                            <span data-bind="text: $component.formatDate(created_on),
                                            class: $component.singleProfile() ? 'd-none':'d-inline d-sm-none' " class="align-text-bottom"></span><br/>

                            <div data-bind="with: $data.details">
                                <strong>Donor info:</strong> <span data-bind="text: name"></span>, <span data-bind="text: email"></span>
                            </div>
                            <strong>Type:</strong> <span data-bind="text: donation_type "></span> <br/>
                            Donation made <strong data-bind="text: on_site ? 'on site' : 'off site'"></strong>. <br/>
                            <span data-bind="with: $component.paymentStatus($data)"> <span data-bind="text: rtext, class: rclass"></span> </span>

                        </div>
                    </div>
                    <div data-bind="if: donations().length === 0">
                        <div class="missing-border p-5 mt-3">
                            No donations yet. But don't lose hope! God is faithful.
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="card p-3">
                        <h5>Site Pages</h5>
                        <p>
                            <a href="#" data-bind="click: toggleWiki">Manage Pages</a>
                        </p>
                        <div data-bind="visible: showWiki">
                            <!-- render the wiki-page component in the sidebar; pass global appState -->
                            <wiki-page params="appState: $root.appState"></wiki-page>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row my-5" data-bind="visible: $root.hasRole('profile_manager')">
                <div class="col">
                    <h2 class="d-inline-block">Profiles</h2>
                    <button class="btn  float-right mb-4" 
                            data-bind="click: $root.navigateFn('/profile/new')"><i class="fas fa-plus fa-2x"></i></button>
                    <div class="d-flex flex-wrap" data-bind="foreach: managedProfiles ">
                        <div class="card m-2" style="width: 17rem" data-bind="class: $component.borderClass($data)">
                            <img class="card-img-top" width="17rem" style="opacity: 0.2" data-bind="attr:{src: $component.storage.profilePictureUrl(picture_url) }" alt="profile picture">

                            <div class="card-img-overlay">
                                <strong class="card-text" data-bind="text: missionary_name"></strong>
                                <div class="card-title" data-bind="text: organization_display_name"></div>
                                <p class="card-text text-danger" data-bind="text: $component.stateText($data.state,$data.published)"> </p>
                                <p class="card-text" data-bind="with: pageStats()">
                                    <i class="fas fa-eye"></i> Page Views: <span data-bind="text: pageViews"></span><br/>
                                    <i class="fas fa-donate"></i> Donation Clicks: <span data-bind="text: donationClicks"></span><br/>
                                    <i class="fas fa-praying-hands"></i> Prayers: <span data-bind="text: prayers"></span>
                                </p>
                                <p data-bind="text: owned ? 'You Own' : 'Worker Owned' "></p>
                            </div>
                            <div class="card-footer text-center" style="z-index:5">
                                <a href="#" title="view"   data-bind="click: $root.navigateFn('/profile/preview/'+missionary_profile_key)"><i title="View" class="mx-2 fa fa-eye fa-2x"></i></a>
                                <a href="#" title="edit"   data-bind="visible: ro !== true, click: $root.navigateFn('/profile/edit/'+missionary_profile_key)"><i title="Edit" class="mx-2 fa fa-edit fa-2x"></i></a>
                                <a href="#" title="invite" data-bind="visible: ro !== true, click: $component.resendInvite"><i title="Invite" class="mx-2 fa fa-user-friends fa-2x"></i></a>
                                <a href="#" title="delete" data-bind="click: $component.deleteProfile"><i title="Delete" class="mx-2 fa fa-trash-alt fa-2x"></i></a>

                            </div>
                        </div>
                    </div>

                    <div data-bind="if: managedProfiles().length === 0">
                        <div class="missing-border p-5 mt-3">
                            <p>
                                You need to add some profiles! 
                            </p>
                            <p>
                                Create new profiles using the "+" button above. Include other workers profiles 
                                by browsing to their profile and clicking "Add to my Page".
                            </p>
                        </div>
                    </div>

                </div>
                
            </div>

            <div data-bind="if: $root.hasRole('organization_review')">

                <org-editor params="appState: $root.appState"></org-editor>

                <div class="row my-5" >
                    <div class="col" data-bind="with: permissionForm">
                        <h2>Permissions</h2>
                        <div class="form-group">
                            <label for="user_key">user_key</label>
                            <input class="form-control" id="user_key" data-bind="value: userKey"/>
                        </div>
                        <div class="form-group">
                            <label for="org_key">organization_key</label>
                            <input class="form-control" id="org_key" data-bind="value: orgKey"/>
                        </div>
                        <div class="form-check " >
                            <label for="read_only" class="form-check-label">
                                <input type="checkbox" id="read_only" required class="form-check-input mb-2" data-bind="checked: readOnly">
                                Read Only (cannot create/edit profiles).
                            </label>
                        </div>


                        <button class="btn btn-secondary" data-bind="click: $component.addUserOrg">Add</button>
                    </div>
                </div>

            </div>
            <!--
            <div class="row my-5 pb-4">
                <div class="col">

                    <button class="btn btn-ergatas-secondary-border" data-bind="click: $root.navigateFn('claim-org') ">Claim Organization</button>
                    <button class="btn btn-outline-danger" data-bind="click: $root.deleteAccount">Delete Account</button>
                </div>
            </div>

            -->



        </div>
    </div>
</div>






