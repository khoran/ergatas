<div id="profile-form" >
    <style>
      @media screen and (max-width: 768px) {
        .selectize-control.plugin-remove_button [data-value] {
            padding-right: 34px !important;
          }
        }
    </style>



    <div data-bind="visible: state() !== 'new_profile'" style="display:none">
        <nav class="nav nav-tabs flex-column flex-md-row mb-4">
            <a class="nav-item  nav-link active" href="#" 
                data-bind="css:{active: state()==='org' },click: setStateFn('org') ">
                Organization</a>
            <a class="nav-item  nav-link" href="#"
                data-bind="css:{active: state()==='personal' },click: setStateFn('personal') ">
                Personal</a>
            <a class="nav-item  nav-link" href="#"
                data-bind="css:{active: state()==='ministry' },click: setStateFn('ministry') ">
                Ministry</a>
            <a class="nav-item  nav-link" href="#"
                data-bind="css:{active: state()==='locations' },click: setStateFn('locations') ">
                Locations</a>
            <a class="nav-item  nav-link" href="#"
                data-bind="css:{active: state()==='support' },click: setStateFn('support') ">
                Support Level</a>
            <a class="nav-item  nav-link" href="#"
                data-bind="css:{active: state()==='files' },click: setStateFn('files') ">
                Files</a>
        </nav>
    </div>



    <form class="profile-form" data-bind="submit: saveProfile">
        <div data-bind="template:{name: currentPage}"></div> 
        <div data-bind="template:{name: currentFooter}"></div> 
    </form>


    <!-- TEMPLATES -->
    <script type="text/html" id="menu_page" >

        <div class="text-right">

            <button class="btn my-4" type="button" data-bind="css:{'btn-ergatas-primary': ! profile.published(), 
                                                           'btn-ergatas-secondary-border': profile.published() },
                                                      enabled: ! isNew(),
                                                      text: profile.published() ? 'Un-Publish' : 'Publish',
                                                      click: togglePublished" ></button>
        </div>

        <div class="alert alert-ergatas" data-bind="visible: ! profile.published()" style="display:hidden">
            Your profile will not be visible to others until you publish it.
        </div>

        <button class="btn btn-secondary btn-block py-4" data-bind="click: $component.setStateFn('org')">
            <h2>Organization</h2></button>
        <button class="btn btn-secondary btn-block py-4" data-bind="click: $component.setStateFn('personal')">
            <h2>Personal</h2></button>
        <button class="btn btn-secondary btn-block py-4" data-bind="click: $component.setStateFn('ministry')">
            <h2>Ministry</h2></button>
        <button class="btn btn-secondary btn-block py-4" data-bind="click: $component.setStateFn('locations')">
            <h2>Locations</h2></button>
        <button class="btn btn-secondary btn-block py-4" data-bind="click: $component.setStateFn('support')">
            <h2>Support Level</h2></button>
        <button class="btn btn-secondary btn-block py-4" data-bind="click: $component.setStateFn('files')">
            <h2>Files</h2></button>


        <div data-bind="visible: saving" class="text-center my-4" style="display:none">
            <img width=25 src="/img/block-spinner2.svg"/>
        </div>
       <!--         <button class="btn btn-block btn-ergatas-primary my-4" data-bind="enable: ! profile.published(),click: publish" >Publish</button>
        <button class="btn btn-block btn-ergatas-secondary my-4" data-bind="enable:  profile.published(),click: unpublish" >Un-Publish</button>
 -->
    </script>
    <script type="text/html" id="new_profile_page" >
        <div data-bind="template:{name:'org_name'}"></div> 
        <div data-bind="template:{name:'donation_link'}"></div> 
        <div data-bind="visible: profile.organization_key, template:{name:'missionary_name'}"></div> 
    </script>
    <script type="text/html" id="new_profile_2_page" >


    </script>
    <script type="text/html" id="" >
    </script>
    <script type="text/html" id="new_profile_footer" >

        <button class="btn  btn-ergatas-secondary-border my-4" data-bind="click: navigateFn('org-application')" >I Can't Find My Organization</button>

        <div class="d-inline-block float-right">
            <div  class="d-inline-block m-4" >
                <img data-bind="visible: saving" style="display:none" width=25 src="/img/block-spinner2.svg"/>
            </div>

            <button class="btn btn-ergatas-primary my-4 " type="submit"
                    data-bind="enable: profile.organization_key"  >Create</button>
        </div>

    </script>
    <script type="text/html" id="footer" >

       <!--  <button class="btn btn-block btn-ergatas-primary my-4" data-bind="enable: profile.organization_key() && ! saved()" type="submit" >
            <span data-bind="text: saved() ? 'Saved!' : 'Save'"></span></button>
        <button class="btn  btn-ergatas-secondary my-4" data-bind="click: $component.cancel" >Cancel </button>
 -->

        <div class=" text-right">
            <button class="btn my-4" type="button" data-bind="css:{'btn-ergatas-secondary-border': ! profile.published(), 
                                                        'btn-ergatas-secondary': profile.published() },
                                                    enabled: ! isNew(),
                                                    text: profile.published() ? 'Un-Publish' : 'Publish',
                                                    click: togglePublished" ></button>


            <div  class="d-inline-block m-4" >
                <img data-bind="visible: saving" style="display:none" width=25 src="/img/block-spinner2.svg"/>
            </div>

            <button class="btn btn-ergatas-primary my-4 " type="submit"
                    data-bind="enable: profile.organization_key"  >
                    <span data-bind="text: isLast() ? (saved() ? 'Saved': 'Save') : 'Save and Continue'"></span></button>
        </div>

        <div class="alert alert-ergatas" data-bind="visible: ! profile.published()" style="display:hidden">
            Your profile will not be visible to others until you publish it.
        </div>


    </script>
    <script type="text/html" id="org_name" >
        <div class='form-group'>
            <label for="organization" class="required" >Organization Name</label>
            Select your organization from the list below.

<!--             <a href="#" class="ml-2" data-bind="click: navigateFn('org-application')"  
                style="font-size:0.8em;">Don't see your organization?</a>
 -->
            <select id="organization" required placeholder="Non-profits" class='form-control'  
                data-bind="selectize:profile.organization_key, selectizeOptions: orgSelectizeOptions"> </select> 
        </div>
        <div data-bind="with: selectedOrganization">

            <img class="float-right" alt="organization logo" data-bind="visible: $data.logo_url, attr:{src:$parent.storage.orgLogoUrl($data && $data.logo_url)  }">
            <div class="h5" >
                <a target="organization" data-bind="attr:{href:website}">
                    <span data-bind="text: $parent.utils.organizationDisplayName($data,true)"></span>
                </a>
            </div>
            <p class="mb-1" style="font-size:0.7em" data-bind="text: $parent.utils.organizationRegisteredName($data)"></p>
            <p>
                <i class="fa fa-map-marker-alt "></i>
                <span data-bind="text: city"></span>, <span data-bind="text: state"></span>
            </p>
        </div>


    </script>

    <script type="text/html" id="missionary_name" >

        <div class='form-group contains-validation-message'>
            <label for="first_name" class="required" >First Name <small> </small></label>
            Include spouses name if applicable. An alias can be used if desired.
            <input class='form-control' required id="first_name" name="first_name" data-bind="value:  profile.first_name,validation"/>
        </div>
        <div class='form-group contains-validation-message'>
            <label for="last_name" class="required" >Last Name</label>
            <input class='form-control' required id="last_name" name="last_name" data-bind="value:  profile.last_name,validation"/>
        </div>


    </script>

    <script type="text/html" id="donation_link" >
        <div data-bind="with: selectedOrganization">
            <div class='form-group contains-validation-message'>
                <label for="donation_url" class="required" >Donation URL</label>
                <div class="validation-error-message w-50 text-right" ></div>
                <p>
                    This is the page users will be taken to, to make a donation to you (we take no part of any donations). The page must be part
                    of your organizations website, which means it must contain
                    <strong><span data-bind="text: $parent.utils.urlRootDomain(website)"></span></strong> (additional subdomains are ok). If it does not, then you should enter 
                    a page that <em>is</em> on your organizations site, but references you in some way. If you 
                    don't have such a page, ask your organization if they can provide such a page for you. 
                    This is how we establish the chain of trust from your organization to you. 
                </p>
                <p>
                    If you're not sure about all that, just paste your link in, we'll let you know if it's valid or not.
                </p>

                <div class="input-group">
                    <!--
                    <div class="input-group-prepend">
                        <div class="input-group-text" data-bind="text: website"></div>
                    </div>
                    -->
                    <input class="form-control" style="min-width:100px" required id="donation_url" placeholder="URL" name="donation_url" 
                        data-bind="urlSuffix: $parent.profile.donation_url, urlBase: website,validation " /> <br>
                </div>
            </div>
        </div>

        <div data-bind="if: profile.organization_key">

        
            <div class='form-group' >
                    <label for="donate_instructions" class="optional" >Donation Instructions</label>
                    Here you can enter any specific instructions to help the user make a donation to you specifically,
                    starting from the URL entered above. This should contain navigation instructions only, no URLs
                    or anything else.
                    <textarea class="w-100" id="donate_instructions" data-bind="value: profile.donate_instructions"
                        placeholder=""></textarea>
            </div>

            <a class="btn btn-ergatas-secondary-border mb-5"  href="#"
                data-bind="click: function(data){ utils.donatePreview(profile.donation_url(),profile.donate_instructions());}">
                Test Donation Link</a>



        </div>


    </script>

    <script type="text/html" id="org_page" >

        <div data-bind="template:{name:'org_name'}"></div> 
        <div data-bind="template:{name:'donation_link'}"></div> 
    </script>

    <script type="text/html" id="personal_page" >

        <div class='form-group profile-picture-upload' >
            <label for="profile-picture" class="optional" >Profile Picture</label>
            A picture of you or your family. This will be cropped to a square.

            <br>

            <div data-bind="visible: profile.picture_url() != null && profile.picture_url() != '' ">
                <img width="200" alt="profile picture" data-bind="attr:{src: storage.profilePictureUrl(profile.picture_url())}"/>
                <br>
            </div>
            <button type="button" class="btn btn-ergatas-secondary-border m-1" data-bind="click: setProfilePicture ">
                Upload Picture</button>
        </div>

        <div data-bind="template:{name:'missionary_name'}"></div> 

        <div class="form-group" >
            <label for="marital_status" class="optional" >Marital Status</label>
            <select class="form-control" id="marital_status" data-bind="value: profile.marital_status">
                <option value="">--</option>
                <option value="single">Single</option>
                <option value="married">Married</option>
            </select>
        </div>
        <div class="form-group" >
            <label for="birth_years" class="optional" >Kids Ages</label>
            If you have any kids, enter the year each was born (this way you don't have to keep updating their ages!).
            <select id="birth_years" class='form-control'  placeholder="Child Birth Years" name="birth_years" 
                data-bind="selectize:profile.kids_birth_years,
                        selectizeOptions: birthYearsSelectizeOptions">
            </select> <br>
        </div>
    </script>

    <script type="text/html" id="locations_page" >

        <location-input params=" lat: profile.location_lat, 
                                lng: profile.location_long, 
                                location: profile.location, 
                                country: profile.country,
                                countryCode: profile.country_code,
                                description: 'Enter the location where you will be serving. You can either click on the map,'+ 
                                    ' or enter a full or partial address in the text field below.' "></location-input>


        <div class='form-group'>
            <label for="impactCountries" class="optional" >Countries Where Your Work is Making an Impact</label>
            If your work is helping missionaries in countries beyond where you live and work, 
            you should select those countries here. Try to be as specific as possible. 
            <country-selector params="countryCodes: profile.impact_countries,countryData: appState.countryList"></country-selector>
        </div>


    </script>

    <script type="text/html" id="support_page" >
        <div class='form-group'>
            <label for="support" >Current Monthly Support </label>
            <div data-bind="visible: profile.current_support_percentage()==='100'" style="display:none">
                <div class="alert alert-ergatas">
                    <p>
                        Praise God! We're so glad you've reached 100% support. Now that you have, we won't show your profile
                        in the search results anymore.
                    </p>
                    <p>
                        You can keep it here though,
                        and if your support ever falls again, you can come back and update your profile and support
                        level, and we'll put you back in the search results.
                    </p>
                    <p>
                        Would you mind <a href="/contact" data-bind="click: navigateFn('/contact')">letting us know</a> 
                        how helpful or not Ergatas was on your journey to full support? 
                        (Don't worry, your changes will still be here when you come back).
                    </p>
                </div>
            </div>
        </div>
        <div> 


            <div class="mt-5" data-bind="supportSlider: [profile.current_support_percentage] "></div>


        </div>
        <!-- <div class="text-center" >
            <h2><span data-bind="text:profile.current_support_percentage"></span>%</h2>
        </div> -->


    </script>

    <script type="text/html" id="ministry_page" >

        <div class="form-group" >
            <label for="jobs" class="optional" >Jobs</label>
            Select whatever job catagories best apply to the work you and/or your spouse are doing.
            If nothing seems even close, <a href="/contact" data-bind="click: navigateFn('contact')">let us know</a>
            and we'll consider adding it. 
            <select id="jobs" class='form-control'  placeholder="Jobs" name="profile_jobs_view" data-bind="selectize:profile.job_catagory_keys,
                selectizeOptions: jobSelectizeOptions">
            </select> <br>
        </div>

        <div class="form-group contains-validation-message" >
            <label for="video_url" class="optional" >Video URL</label>
            If you have a video describing your ministry, you can paste a link to it here. Currently only YouTube and Vimeo links 
            are supported.  <a href="/contact" data-bind="click: navigateFn('contact')">Let us know</a> if you'd like to use another
            video source.
            <input id="video_url" class="form-control" data-bind="textInput: profile.video_url,videoURL,validation" type="url">
        </div>



        
        <div class='form-group'>
            <label id="description_label" for="description" class="required" >Description of Your Ministry </label>
            Here you can introduce yourself / family, and then describe your specific ministry within 
            the organization. Tell people what your passionate about! Tell them how their partnership with you will
            result in Kingdom impact.
            <div id="description"  aria-labelledby="description_label" data-bind="editor: profile.description, editorOptions:{
                    tagsToRemove: ['script', 'link'],
                    resetCss: true,
                    removeformatPasted: true,
                    autogrow: true,
                    btns: [
                        ['formatting'],
                        ['strong', 'em', 'del'],
                        ['superscript', 'subscript'],
                        ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
                        ['unorderedList', 'orderedList'],
                        ['horizontalRule'],
                        ['removeformat'],
                        ['fullscreen']
                    ]
                }">
            </div>
            <br>
        </div>
        <div class='form-group'>
            <label for="movementStage" class="optional" >Are You Pursuing a Movement?</label>
            If you are pursuing a Church Planting Movement (CPM) or a Diciple Makeing Movement (DMM), 
            select what <a href="https://multmove.net/cpm-continuum/" target="_blank" rel="noopener">
            generation</a> you are currently in. 
            <select class="form-control" data-bind="value: profile.movement_stage ">
                <option value="-1">Select Movement Stage</option>
                <option value="0">No Purposeful Plan Yet</option>
                <option value="1">Moving Purposefully (Gen 1)</option>
                <option value="2">Focused (Gen 2)</option>
                <option value="3">Breakthrough (G3)</option>
                <option value="4">Emerging CPM (Gen 4)</option>
                <option value="5">Church Planting Movement</option>
                <option value="6">Sustained CPM</option>
                <option value="7">Multiplying CPMs</option>
            </select>
        </div>
        <div class="form-group" >
            <label for="tags" class="optional" >Tags</label>
            Select any tags that apply to you or your ministry.
            If you'd like to create a new tag, <a href="/contact" data-bind="click: navigateFn('contact')">let us know</a>
            and we'll consider it. 
            <select id="tags"  class='form-control' name="tags" data-bind="selectize:profile.tag_keys,
                selectizeOptions: tagSelectizeOptions">
            </select> <br>
        </div>
        <div class="form-group" >
            <label for="causes" class="optional" >Causes</label>
            Select any causes that apply to you or your ministry.
            If you'd like to create a new cause, <a href="/contact" data-bind="click: navigateFn('contact')">let us know</a>
            and we'll consider it. 
            <select id="causes"  class='form-control'  name="causes" data-bind="selectize:profile.cause_keys,
                selectizeOptions: causeSelectizeOptions">
            </select> <br>
        </div>

        <div class="form-group" >
            <label for="people_groups" class="optional d-inline-block" >People Groups</label>

            <div  class="d-inline-block ml-3">
                <img  style="display:none" data-bind="visible: peopleGroupRunning" width=25 src="/img/block-spinner2.svg"/>
            </div>
            <br>
            If you are (or will be) working with any specific people groups, select them from the 
            list below. 
            <select id="people_groups"  class='form-control' name="people_groups" data-bind="selectize:profile.people_id3_codes,
                selectizeOptions: peopleGroupSelectizeOptions">
            </select>
        </div>

        <div class="form-group" >
            <label for="languages" class="optional d-inline-block" >Language(s) of People(s) to be Reached</label>

            <div  class="d-inline-block ml-3">
                <img  style="display:none" data-bind="visible: languageRunning" width=25 src="/img/block-spinner2.svg"/>
            </div>
            <br>
            Select the languages of the people groups you are or will be working with.
            <select id="languages"  class='form-control' name="languages" data-bind="selectize:profile.rol3_codes,
                selectizeOptions: languageSelectizeOptions">
            </select>
        </div>

    </script>

    <script type="text/html" id="files_page">

        <div class='form-group'>
            <label for="description" class="optional" >Additional Files</label><br>
            Here you can upload up to 10 additional files. These can be past newsletters, additional pictures, or anything
            else you think might help someone get to know you and your ministry better.

            <file-collection params="filenameFilter: [profile.picture_url()],
                    server: server,
                    bucketPrefix: userId()"></file-collection>
        </div>

    </script>

</div>